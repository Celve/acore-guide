# Supervisor Binary Interface (SBI)

## SBI 原理及简介

### 引子

我们都知道如何写一个 hello world 程序。但是，为什么这个程序可以在终端上打印 hello world 呢？

解答这个问题前，我们需要先把问题简化一些。让我们回到上个世纪，那个真的用打印机作为输出的年代。

打印机的具体实现这里我们不关心，我们只需要知道，操作系统往一个特定的地址写一个特定的数据，打印机终端就能执行一个操作，如打印字符 h 或者打印机换到下一行，这叫做 MMIO (Memory mapping I/O)。（如果你实在是特别好奇为什么这样是可以的，下面列举了一种可行的实现。）

<details>
<summary><strong>点击查看一种可行的 MMIO 实现</strong></summary>
当 CPU 执行到读内存地址时，（在 MMU 翻译到物理地址后，）会向主板上的芯片发送写请求，主板上的芯片会区分地址对应的物理设备（这个设备可能是内存，也可能是输入输出设备，如打印机）。当对应的物理设备是打印机时，会采取硬件所要求的方式正确处理请求。
</details>

所以说，操作输入输出设备，本质上就是读/写 MMIO 地址（这个地址和一般的地址的形式是一样的）。

### 什么是 SBI？

从字面意思上，SBI 就是 supervisor 的二进制接口。因此，SBI 的任务就是要为 supervisor（也就是内核）提供支持。

上面的打印字符，就是 SBI 需要实现的功能，因为内核本身并没有这个能力，我们需要通过操作外部设备实现。

除此以外，内核还需要进入 machine mode 做一些操作，那么这个也需要 SBI 提供支持。

### SBI 的需求

了解了 SBI 的作用，我们现在需要大概分析一下 SBI 需要提供哪些功能。

SBI 作为 supervisor 的接口，其本身主要是在为 supervisor（也就是内核）服务。

内核大致需要这些接口：（具体要实现的内容可以不一样，取决于你的内核需要什么）

- IO（在控制台输出字符、从控制台读取字符）；
- 其他硬件操作（如关机）；
- 只能在 machine mode 操作的设置（如计时器、修改一些特权寄存器的特定比特）。

## SBI 实现细节

## SBI 要求
